<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ToolBox Hub â€” Advanced Habit Tracker (Pro)</title>
<meta name="description" content="Advanced Habit Tracker â€” unlimited habits, streaks, reminders, exports. ToolBox Hub PRO." />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
Â  :root{
Â  Â  --bg: #0f172a;
Â  Â  --card:#0b1220;
Â  Â  --accent-start:#ff7a7a;
Â  Â  --accent-end:#7b9cff;
Â  Â  --muted:#9aa4b2;
Â  Â  --glass: rgba(255,255,255,0.04);
Â  Â  --success: #10b981;
Â  Â  --danger:#ff6b6b;
Â  Â  --radius:12px;
Â  Â  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
Â  }

Â  html,body{height:100%}
Â  body{
Â  Â  margin:0;
Â  Â  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 25%, #9be7ff 100%);
Â  Â  -webkit-font-smoothing:antialiased;
Â  Â  -moz-osx-font-smoothing:grayscale;
Â  Â  color:#0b1220;
Â  Â  padding:18px;
Â  Â  display:flex;
Â  Â  align-items:flex-start;
Â  Â  justify-content:center;
Â  }

Â  .container{
Â  Â  width:100%;
Â  Â  max-width:1100px;
Â  }

Â  header{
Â  Â  display:flex;
Â  Â  align-items:center;
Â  Â  gap:16px;
Â  Â  margin-bottom:14px;
Â  }

Â  .brand {
Â  Â  display:flex;
Â  Â  align-items:center;
Â  Â  gap:12px;
Â  }

Â  .logo {
Â  Â  width:56px;height:56px;border-radius:12px;
Â  Â  background:linear-gradient(135deg,var(--accent-start),var(--accent-end));
Â  Â  display:flex;align-items:center;justify-content:center;
Â  Â  color:white;font-weight:700;font-size:18px;
Â  Â  box-shadow:0 6px 18px rgba(11,18,32,0.08);
Â  }

Â  .title {
Â  Â  font-size:18px;font-weight:700;
Â  }

Â  .subtitle { font-size:13px;color:var(--muted) }

Â  .nav {
Â  Â  margin-left:auto; display:flex; gap:10px; align-items:center;
Â  }

Â  .btn {
Â  Â  display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;
Â  Â  background:rgba(255,255,255,0.95);border:1px solid rgba(11,18,32,0.06);cursor:pointer;font-weight:600;
Â  Â  box-shadow:0 4px 18px rgba(11,18,32,0.06);
Â  Â  text-decoration: none; /* Add for <a> tags */
Â  Â  color: inherit; /* Add for <a> tags */
Â  }

Â  .pro-badge {
Â  Â  background: linear-gradient(90deg,var(--accent-start),var(--accent-end));
Â  Â  color:white;padding:6px 10px;border-radius:10px;font-weight:700;
Â  }

Â  main {
Â  Â  display:grid;
Â  Â  grid-template-columns: 1fr 420px;
Â  Â  gap:18px;
Â  }

Â  /* mobile first */
Â  @media (max-width:900px){
Â  Â  main{grid-template-columns: 1fr; padding-bottom:48px}
Â  Â  .sidebar { order: -1; }
Â  }

Â  /* Left panel (tracker) */
Â  .card {
Â  Â  background: rgba(255,255,255,0.85);
Â  Â  border-radius: var(--radius);
Â  Â  padding:16px; box-shadow: 0 8px 30px rgba(11,18,32,0.06);
Â  }

Â  .controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; align-items:center; }
Â  .input { flex:1; min-width:150px;padding:10px;border-radius:8px;border:1px solid rgba(11,18,32,0.06); }
Â  .small { padding:8px 10px;font-size:14px; }

Â  .habit-list { display:grid; gap:10px; margin-top:10px; }
Â  .habit {
Â  Â  display:flex; align-items:center; gap:10px; padding:12px; border-radius:10px;
Â  Â  background:var(--glass); border:1px solid rgba(11,18,32,0.03);
Â  }

Â  .habit .meta { flex:1; min-width:0 }
Â  .habit h4 { margin:0; font-size:16px; font-weight:700; color:#07122a; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
Â  .habit p { margin:6px 0 0; font-size:13px; color:var(--muted); }

Â  .habit .actions { display:flex; gap:8px; align-items:center; }
Â  .icon-btn { border:none; background:transparent; padding:8px;border-radius:8px; cursor:pointer; }
Â  .check-btn { background:linear-gradient(90deg,var(--accent-start),var(--accent-end)); color:white; padding:8px 12px; border-radius:8px; font-weight:700; border:none; cursor:pointer; }

Â  /* Right sidebar */
Â  .sidebar .card { position:sticky; top:18px; }
Â  .stats { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-bottom:12px; }
Â  .stat { background:linear-gradient(90deg,#ffffff,#ffffff); padding:12px;border-radius:10px;text-align:center; }
Â  .stat h3 { margin:0; font-size:18px }
Â  .stat p { margin:0; color:var(--muted); font-size:13px; }

Â  canvas { width:100% !important; height:160px !important; border-radius:8px; background: linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.45)); }

Â  .footer-note { font-size:13px; color:var(--muted); margin-top:12px; }

Â  /* Locked overlay */
Â  .locked {
Â  Â  display:flex; gap:12px; align-items:center; justify-content:center; flex-direction:column;
Â  Â  padding:36px; text-align:center;
Â  }
Â  .locked p { margin:0 0 12px;font-size:16px;color:#07122a;}
Â  /* Updated Stripe Button Style to be an <a> tag */
Â  .stripe-btn { 
Â  Â  background:linear-gradient(90deg,var(--accent-start),var(--accent-end)); 
Â  Â  color:white; 
Â  Â  padding:12px 16px;
Â  Â  border-radius:12px;
Â  Â  border:none;
Â  Â  font-weight:700; 
Â  Â  cursor:pointer;
Â  Â  text-decoration: none; /* Important for <a> tag */
Â  Â  display: inline-block;
Â  }

Â  /* tiny */
Â  .muted { color:var(--muted); font-size:13px; }
Â  .small-txt { font-size:12px;color:var(--muted); }

Â  /* responsive tweaks */
Â  @media (max-width:600px){
Â  Â  .logo{width:48px;height:48px}
Â  Â  .title{font-size:16px}
Â  Â  .input{padding:10px}
Â  }
</style>
</head>
<body>
Â  <div class="container">
Â  Â  <header>
Â  Â  Â  <div class="brand">
Â  Â  Â  Â  <div class="logo">TB</div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="title">ToolBox Hub <span class="pro-badge">PRO</span></div>
Â  Â  Â  Â  Â  <div class="subtitle">Advanced Habit Tracker</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <nav class="nav">
Â  Â  Â  Â  <a class="btn" href="https://omnitoolaz.com" target="_blank">Back to ToolBox Hub</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a id="customer-portal-link" class="btn" href="https://billing.stripe.com/p/login/dRm14p9vl1vD5U72dYbsc00" target="_blank">Manage Subscription</a>
Â  Â  Â  Â  <button id="unlock-sample" class="btn" title="Set pro unlocked locally (dev)">Unlock (dev)</button>
Â  Â  Â  </nav>
Â  Â  </header>

Â  Â  <main>
Â  Â  Â  Â  Â  Â  <section class="card" id="app">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="locked-screen" class="locked" style="display:none;">
Â  Â  Â  Â  Â  <h2>Advanced Habit Tracker â€” PRO</h2>
Â  Â  Â  Â  Â  <p>Unlock unlimited habits, smart reminders, streak analytics and export features.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a id="go-pay" 
Â  Â  Â  Â  Â  Â  Â class="stripe-btn" 
Â  Â  Â  Â  Â  Â  Â href="https://buy.stripe.com/payment-id-heredRm1" 
Â  Â  Â  Â  Â  Â  Â target="_blank" 
Â  Â  Â  Â  Â  Â  Â rel="noopener noreferrer">
Â  Â  Â  Â  Â  Â  Subscribe â‚¹299/month â€” Secure with Stripe
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  <p class="small-txt">After payment you will be redirected here for full access. Your purchase unlocks all pro tools.</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="tracker-ui" style="display:none;">
Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <h2 style="margin:0 0 6px 0">My Habits</h2>
Â  Â  Â  Â  Â  Â  Â  <div class="muted">Track daily consistency. Your progress is saved locally.</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="small-txt">Pro features: reminders, exports, charts</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  <input id="habit-name" class="input" placeholder="Add a new habit (e.g., Read 20 pages)" />
Â  Â  Â  Â  Â  Â  <select id="habit-frequency" class="small">
Â  Â  Â  Â  Â  Â  Â  <option value="daily">Daily</option>
Â  Â  Â  Â  Â  Â  Â  <option value="weekly">Weekly</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <button id="add-habit" class="btn">Add Habit</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  <input id="search" class="input" placeholder="Search habits..." />
Â  Â  Â  Â  Â  Â  <button id="export-btn" class="btn small">Export CSV</button>
Â  Â  Â  Â  Â  Â  <label class="btn small" style="cursor:pointer;"><input id="import-file" type="file" accept=".csv" style="display:none">Import</label>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div id="habit-list" class="habit-list"></div>

Â  Â  Â  Â  Â  <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
Â  Â  Â  Â  Â  Â  <button id="clear-all" class="btn small">Clear All (dev)</button>
Â  Â  Â  Â  Â  Â  <button id="request-notif" class="btn small">Enable Reminders</button>
Â  Â  Â  Â  Â  Â  <button id="mark-today" class="btn small">Mark Today's Date</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="footer-note">Tip: After successful Stripe payment, you can either redirect to this page with <code>?pro=1</code> or set <code>localStorage.pro_unlocked = "1"</code> from your server verification.</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <aside class="sidebar">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h3 style="margin-top:0">Progress Overview</h3>
Â  Â  Â  Â  Â  <div class="stats" style="margin-top:10px">
Â  Â  Â  Â  Â  Â  <div class="stat">
Â  Â  Â  Â  Â  Â  Â  <h3 id="total-habits">0</h3>
Â  Â  Â  Â  Â  Â  Â  <p class="muted">Total Habits</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat">
Â  Â  Â  Â  Â  Â  Â  <h3 id="today-completed">0</h3>
Â  Â  Â  Â  Â  Â  Â  <p class="muted">Completed Today</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat">
Â  Â  Â  Â  Â  Â  Â  <h3 id="avg-complete">0%</h3>
Â  Â  Â  Â  Â  Â  Â  <p class="muted">30-day Avg</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="stat">
Â  Â  Â  Â  Â  Â  Â  <h3 id="longest-streak">0</h3>
Â  Â  Â  Â  Â  Â  Â  <p class="muted">Longest Streak</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <h4 style="margin:8px 0 6px 0">Last 30 Days</h4>
Â  Â  Â  Â  Â  <canvas id="chart"></canvas>

Â  Â  Â  Â  Â  <div style="margin-top:12px; display:flex; gap:8px;">
Â  Â  Â  Â  Â  Â  <button id="import-sample" class="btn small">Load Sample Data</button>
Â  Â  Â  Â  Â  Â  <button id="reset-stats" class="btn small">Reset Stats</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <p class="muted" style="margin-top:12px">Local only: this demo stores data in your browser storage. For production, sync server-side or protect the page behind authenticated access after Stripe verification.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
Â  Â  </main>
Â  </div>

<script>
/*
Â  Advanced Habit Tracker (Pro)
Â  - Stores habits in localStorage under key "tb_habits"
Â  - Unlocking: if URL contains ?pro=1 OR localStorage.pro_unlocked === "1", the app UI shows.
Â  - REPLACE the two placeholder links below with your actual Stripe links.
*/

// âš ï¸ REPLACE THIS with your actual Stripe Payment Link (for new subscriptions)
const STRIPE_PAYMENT_LINK = "YOUR_STRIPE_PAYMENT_LINK"; 

// âš ï¸ REPLACE THIS with your Stripe Customer Portal Login Link (for existing customers to manage billing)
const STRIPE_PORTAL_LINK = "https://billing.stripe.com/p/login/dRm14p9vl1vD5U72dYbsc00"; 


// Utils
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,7);
const todayISO = (d = new Date()) => d.toISOString().slice(0,10);
const parseDate = s => new Date(s + 'T00:00:00');
const daysBetween = (a,b) => Math.round((b-a)/(24*3600*1000));

// storage helpers
function saveData(data){
Â  localStorage.setItem('tb_habits', JSON.stringify(data));
}
function loadData(){
Â  return JSON.parse(localStorage.getItem('tb_habits') || '[]');
}

// Chart data (simple)
function drawChart(percentageArray){
Â  const canvas = document.getElementById('chart');
Â  if(!canvas.getContext) return;
Â  const ctx = canvas.getContext('2d');
Â  canvas.width = canvas.clientWidth * devicePixelRatio;
Â  canvas.height = canvas.clientHeight * devicePixelRatio;
Â  ctx.scale(devicePixelRatio, devicePixelRatio);
Â  const w = canvas.clientWidth, h = canvas.clientHeight;
Â  ctx.clearRect(0,0,w,h);

Â  // background gradient
Â  const g = ctx.createLinearGradient(0,0,w,0);
Â  g.addColorStop(0, '#ff9a9e');
Â  g.addColorStop(1, '#7b9cff');
Â  ctx.fillStyle = g;
Â  const barWidth = Math.max(4, (w - 12) / percentageArray.length - 2);
Â  percentageArray.forEach((p,i) => {
Â  Â  const x = 6 + i*(barWidth+2);
Â  Â  const barH = (p/100) * (h - 20);
Â  Â  ctx.fillRect(x, h - 10 - barH, barWidth, barH);
Â  });

Â  // axis labels
Â  ctx.fillStyle = 'rgba(11,18,32,0.6)';
Â  ctx.font = '12px system-ui';
Â  ctx.fillText('0%', 6, h - 2);
Â  ctx.fillText('100%', w - 36, 12);
}

// Core app
document.addEventListener('DOMContentLoaded', () => {
Â  const lockedScreen = document.getElementById('locked-screen');
Â  const trackerUI = document.getElementById('tracker-ui');
Â  // Removed goPayBtn click listener, since it's an <a> tag now
Â  const unlockDev = document.getElementById('unlock-sample');
Â  const customerPortalLink = document.getElementById('customer-portal-link');

Â  // Set the link dynamically (though it's already set in HTML, this is safer)
Â  customerPortalLink.href = STRIPE_PORTAL_LINK;
Â  
Â  // Also set the payment link dynamically
Â  document.getElementById('go-pay').href = STRIPE_PAYMENT_LINK;


Â  function isPro() {
Â  Â  const q = new URLSearchParams(window.location.search);
Â  Â  if (q.get('pro') === '1') {
Â  Â  Â  // If redirected with ?pro=1, save to local storage for future visits
Â  Â  Â  try { localStorage.setItem('pro_unlocked', '1'); } catch(e){}
Â  Â  Â  return true;
Â  Â  }
Â  Â  return localStorage.getItem('pro_unlocked') === '1';
Â  }

Â  function showGate(){
Â  Â  if(isPro()){
Â  Â  Â  lockedScreen.style.display = 'none';
Â  Â  Â  trackerUI.style.display = 'block';
Â  Â  Â  // Show the "Manage Subscription" link only if Pro is unlocked
Â  Â  Â  customerPortalLink.style.display = 'inline-flex';
Â  Â  Â  renderAll();
Â  Â  } else {
Â  Â  Â  lockedScreen.style.display = 'flex';
Â  Â  Â  trackerUI.style.display = 'none';
Â  Â  Â  // Hide the "Manage Subscription" link until Pro is unlocked
Â  Â  Â  customerPortalLink.style.display = 'none';
Â  Â  }
Â  }

Â  // dev unlock (for testing, sets local storage)
Â  unlockDev.addEventListener('click', () => {
Â  Â  localStorage.setItem('pro_unlocked', '1');
Â  Â  alert('Pro unlocked locally for testing. Reloading...');
Â  Â  // Re-check access and render UI
Â  Â  showGate();
Â  });

Â  showGate();

Â  // UI elements
Â  const habitListEl = document.getElementById('habit-list');
Â  const nameInput = document.getElementById('habit-name');
Â  const freqInput = document.getElementById('habit-frequency');
Â  const addBtn = document.getElementById('add-habit');
Â  const searchInput = document.getElementById('search');
Â  const exportBtn = document.getElementById('export-btn');
Â  const importFile = document.getElementById('import-file');
Â  const totalHabitsEl = document.getElementById('total-habits');
Â  const todayCompletedEl = document.getElementById('today-completed');
Â  const avgCompleteEl = document.getElementById('avg-complete');
Â  const longestStreakEl = document.getElementById('longest-streak');
Â  const importSample = document.getElementById('import-sample');
Â  const clearAllBtn = document.getElementById('clear-all');
Â  const resetStatsBtn = document.getElementById('reset-stats');
Â  const requestNotif = document.getElementById('request-notif');
Â  const markTodayBtn = document.getElementById('mark-today');

Â  function getHabits(){
Â  Â  return loadData();
Â  }

Â  function setHabits(data){
Â  Â  saveData(data);
Â  Â  renderAll();
Â  }

Â  function addHabit(name, freq){
Â  Â  const data = getHabits();
Â  Â  const note = { id: uid(), name: name.trim(), freq: freq || 'daily', createdAt: new Date().toISOString(), completed: {}, longestStreak: 0 };
Â  Â  data.unshift(note);
Â  Â  setHabits(data);
Â  }

Â  function editHabit(id, updates){
Â  Â  const data = getHabits().map(h => h.id === id ? {...h, ...updates} : h);
Â  Â  setHabits(data);
Â  }

Â  function removeHabit(id){
Â  Â  const data = getHabits().filter(h => h.id !== id);
Â  Â  setHabits(data);
Â  }

Â  function toggleComplete(id, dateISO){
Â  Â  const data = getHabits().map(h => {
Â  Â  Â  if(h.id !== id) return h;
Â  Â  Â  const completed = {...h.completed};
Â  Â  Â  if(completed[dateISO]) delete completed[dateISO];
Â  Â  Â  else completed[dateISO] = true;
Â  Â  Â  return {...h, completed};
Â  Â  });
Â  Â  setHabits(data);
Â  }

Â  // Stats utilities
Â  function calcLongestStreak(completedDates){
Â  Â  // completedDates: keys of dates where completed true
Â  Â  const days = Object.keys(completedDates).sort();
Â  Â  if(!days.length) return 0;
Â  Â  let longest = 0, current = 1;
Â  Â  for(let i=1;i<days.length;i++){
Â  Â  Â  const prev = parseDate(days[i-1]);
Â  Â  Â  const curr = parseDate(days[i]);
Â  Â  Â  if(daysBetween(prev, curr) === 1) current++; else { longest = Math.max(longest, current); current = 1; }
Â  Â  }
Â  Â  longest = Math.max(longest, current);
Â  Â  return longest;
Â  }

Â  function compute30DayCompletionPercent(){
Â  Â  const data = getHabits();
Â  Â  const last30 = [];
Â  Â  for(let i=29;i>=0;i--){
Â  Â  Â  const d = new Date(); d.setDate(d.getDate() - i);
Â  Â  Â  const iso = todayISO(d);
Â  Â  Â  last30.push(iso);
Â  Â  }
Â  Â  const result = last30.map(date => {
Â  Â  Â  let count = 0;
Â  Â  Â  data.forEach(h => { if(h.completed && h.completed[date]) count++; });
Â  Â  Â  return data.length ? Math.round((count/data.length) * 100) : 0;
Â  Â  });
Â  Â  return result;
Â  }

Â  function renderAll(){
Â  Â  const data = getHabits();
Â  Â  const filter = searchInput.value.trim().toLowerCase();
Â  Â  habitListEl.innerHTML = '';
Â  Â  const today = todayISO();
Â  Â  let todayCompleted = 0;
Â  Â  let longest = 0;
Â  Â  data.forEach(h => {
Â  Â  Â  if(filter && !h.name.toLowerCase().includes(filter)) return;
Â  Â  Â  const doneToday = !!(h.completed && h.completed[today]);
Â  Â  Â  if(doneToday) todayCompleted++;
Â  Â  Â  longest = Math.max(longest, calcLongestStreak(h.completed || {}));

Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  div.className = 'habit';

Â  Â  Â  const meta = document.createElement('div');
Â  Â  Â  meta.className = 'meta';
Â  Â  Â  const h4 = document.createElement('h4'); h4.textContent = h.name;
Â  Â  Â  const p = document.createElement('p'); p.textContent = `Frequency: ${h.freq} â€¢ Created: ${new Date(h.createdAt).toLocaleDateString()}`;

Â  Â  Â  meta.appendChild(h4); meta.appendChild(p);

Â  Â  Â  const actions = document.createElement('div'); actions.className = 'actions';

Â  Â  Â  const chk = document.createElement('button');
Â  Â  Â  chk.className = 'check-btn';
Â  Â  Â  chk.textContent = doneToday ? 'Completed' : 'Mark Complete';
Â  Â  Â  chk.addEventListener('click', () => toggleComplete(h.id, todayISO()));

Â  Â  Â  const edit = document.createElement('button');
Â  Â  Â  edit.className = 'icon-btn';
Â  Â  Â  edit.innerHTML = 'âœï¸';
Â  Â  Â  edit.title = 'Edit';
Â  Â  Â  edit.addEventListener('click', () => {
Â  Â  Â  Â  const newName = prompt('Edit habit name', h.name);
Â  Â  Â  Â  if(newName && newName.trim()) editHabit(h.id, { name: newName.trim() });
Â  Â  Â  });

Â  Â  Â  const del = document.createElement('button');
Â  Â  Â  del.className = 'icon-btn';
Â  Â  Â  del.innerHTML = 'ðŸ—‘ï¸';
Â  Â  Â  del.title = 'Delete';
Â  Â  Â  del.addEventListener('click', () => {
Â  Â  Â  Â  if(confirm('Delete this habit?')) removeHabit(h.id);
Â  Â  Â  });

Â  Â  Â  actions.appendChild(chk); actions.appendChild(edit); actions.appendChild(del);

Â  Â  Â  div.appendChild(meta); div.appendChild(actions);
Â  Â  Â  habitListEl.appendChild(div);
Â  Â  });

Â  Â  totalHabitsEl.textContent = data.length;
Â  Â  todayCompletedEl.textContent = todayCompleted;
Â  Â  longestStreakEl.textContent = longest;

Â  Â  // 30-day average
Â  Â  const arr = compute30DayCompletionPercent();
Â  Â  const avg = arr.reduce((a,b)=>a+b,0) / (arr.length || 1);
Â  Â  avgCompleteEl.textContent = Math.round(avg) + '%';
Â  Â  drawChart(arr);
Â  }

Â  // Add / Search / Export / Import
Â  addBtn.addEventListener('click', () => {
Â  Â  const name = nameInput.value.trim();
Â  Â  if(!name) return alert('Enter a habit name');
Â  Â  addHabit(name, freqInput.value);
Â  Â  nameInput.value = '';
Â  });

Â  nameInput.addEventListener('keydown', e => { if(e.key === 'Enter') addBtn.click(); });

Â  searchInput.addEventListener('input', () => renderAll());

Â  exportBtn.addEventListener('click', () => {
Â  Â  const data = getHabits();
Â  Â  if(!data.length) return alert('No habits to export');
Â  Â  // CSV: id,name,freq,createdAt,completedDates(sep|),longest
Â  Â  const rows = [['id','name','freq','createdAt','completed','longestStreak']];
Â  Â  data.forEach(h => {
Â  Â  Â  const completed = Object.keys(h.completed || {}).join('|');
Â  Â  Â  rows.push([h.id, JSON.stringify(h.name), h.freq, h.createdAt, completed, h.longestStreak || 0]);
Â  Â  });
Â  Â  const csv = rows.map(r => r.join(',')).join('\n');
Â  Â  const blob = new Blob([csv], {type:'text/csv'});
Â  Â  const url = URL.createObjectURL(blob);
Â  Â  const a = document.createElement('a'); a.href = url; a.download = 'tb_habits_export.csv'; a.click();
Â  Â  URL.revokeObjectURL(url);
Â  });

Â  importFile.addEventListener('change', (ev) => {
Â  Â  const f = ev.target.files[0];
Â  Â  if(!f) return;
Â  Â  const reader = new FileReader();
Â  Â  reader.onload = () => {
Â  Â  Â  const txt = reader.result;
Â  Â  Â  // naive CSV parse
Â  Â  Â  const lines = txt.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
Â  Â  Â  const out = [];
Â  Â  Â  for(let i=1;i<lines.length;i++){
Â  Â  Â  Â  const cols = lines[i].split(',');
Â  Â  Â  Â  const id = cols[0] || uid();
Â  Â  Â  Â  const name = cols[1] ? JSON.parse(cols[1]) : ('Imported ' + id);
Â  Â  Â  Â  const freq = cols[2] || 'daily';
Â  Â  Â  Â  const createdAt = cols[3] || new Date().toISOString();
Â  Â  Â  Â  const completed = {};
Â  Â  Â  Â  if(cols[4]) cols[4].split('|').forEach(d => { if(d) completed[d] = true; });
Â  Â  Â  Â  const longest = parseInt(cols[5]||'0',10);
Â  Â  Â  Â  out.push({ id, name, freq, createdAt, completed, longestStreak: longest });
Â  Â  Â  }
Â  Â  Â  setHabits(out);
Â  Â  Â  alert('Import complete');
Â  Â  Â  importFile.value = '';
Â  Â  };
Â  Â  reader.readAsText(f);
Â  });

Â  importSample.addEventListener('click', () => {
Â  Â  const sample = [
Â  Â  Â  { id: uid(), name: 'Read 20 pages', freq:'daily', createdAt:new Date().toISOString(), completed:{}, longestStreak:0 },
Â  Â  Â  { id: uid(), name: 'Morning Walk 20 min', freq:'daily', createdAt:new Date().toISOString(), completed:{}, longestStreak:0 },
Â  Â  Â  { id: uid(), name: 'Log Expenses', freq:'daily', createdAt:new Date().toISOString(), completed:{}, longestStreak:0 },
Â  Â  ];
Â  Â  // mark some previous completion to make chart interesting
Â  Â  const d = new Date();
Â  Â  for(let i=0;i<10;i++){
Â  Â  Â  const iso = todayISO(new Date(d.getFullYear(), d.getMonth(), d.getDate() - i));
Â  Â  Â  sample.forEach((h, idx) => {
Â  Â  Â  Â  if(Math.random() > 0.4) h.completed[iso] = true;
Â  Â  Â  });
Â  Â  }
Â  Â  setHabits(sample);
Â  });

Â  clearAllBtn.addEventListener('click', () => {
Â  Â  if(confirm('Clear all local data?')) { localStorage.removeItem('tb_habits'); renderAll(); }
Â  });

Â  resetStatsBtn.addEventListener('click', () => {
Â  Â  const data = getHabits().map(h => ({ ...h, completed: {}, longestStreak: 0 }));
Â  Â  setHabits(data);
Â  });

Â  requestNotif.addEventListener('click', async () => {
Â  Â  if(!('Notification' in window)) return alert('Browser notifications not supported');
Â  Â  if(Notification.permission === 'granted') return alert('Notifications already enabled');
Â  Â  const res = await Notification.requestPermission();
Â  Â  if(res === 'granted') alert('Notifications enabled. You will get reminders if scheduled.');
Â  });

Â  markTodayBtn.addEventListener('click', () => {
Â  Â  // Mark all habits today (dev convenience)
Â  Â  const data = getHabits().map(h => ({ ...h, completed: { ...(h.completed||{}), [todayISO()]: true } }));
Â  Â  setHabits(data);
Â  });

Â  // Basic notification scheduler (simple demo)
Â  // For production, use Service Worker and server push for reliable reminders
Â  function scheduleDailyReminder(habit){
Â  Â  if(!('Notification' in window)) return;
Â  Â  if(Notification.permission !== 'granted') return;
Â  Â  const title = 'Habit Reminder';
Â  Â  const body = `Don't forget: ${habit.name}`;
Â  Â  // Show immediately for demo
Â  Â  new Notification(title, { body });
Â  }

Â  // On load, compute some derived properties for each habit
Â  function recalcDerived(){
Â  Â  const data = getHabits().map(h => {
Â  Â  Â  const longest = calcLongestStreak(h.completed || {});
Â  Â  Â  return { ...h, longestStreak: longest };
Â  Â  });
Â  Â  setHabits(data);
Â  }

Â  // initial render
Â  renderAll();

Â  // small autosave on visibilitychange
Â  document.addEventListener('visibilitychange', () => {
Â  Â  if(document.visibilityState === 'hidden') saveData(getHabits());
Â  });

Â  // periodic recalc & rerender (useful to update stats)
Â  setInterval(() => {
Â  Â  recalcDerived();
Â  Â  renderAll();
Â  }, 5000);
});
</script>
</body>
</html>
